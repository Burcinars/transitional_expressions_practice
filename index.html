<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Transitional Expressions Practice</title>
  <style>
    :root{
      --bg:#fbfbfa; --card:#ffffff; --ink:#1f1f1f; --muted:#5a5550; --border:#e7e2dd;
      --a:#eef5ff; --aInk:#2f5b95;
      --b:#f4f1ff; --bInk:#5a44a6;
      --c:#fff3e8; --cInk:#8a4b1f;
      --good:#156b3b; --bad:#8f1f1f;
      --shadow:0 10px 28px rgba(0,0,0,0.06);
      --r:18px;
    }

    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Arial,sans-serif;
      line-height:1.6; font-size:16.5px;
    }

    .wrap{ max-width:1020px; margin:0 auto; padding:22px 18px 44px; }

    .top,.panel{
      background:var(--card); border:1px solid var(--border);
      border-radius:var(--r); box-shadow:var(--shadow);
    }

    .top{ padding:18px 20px; }

    .k{
      font-size:12.5px; letter-spacing:0.12em; text-transform:uppercase;
      color:var(--muted); margin:0 0 6px 0;
    }

    h1{ margin:0; font-size:22px; font-weight:780; }

    .sub{ margin-top:8px; color:var(--muted); max-width:96ch; }

    .grid{
      display:grid; grid-template-columns:1.25fr 0.75fr; gap:16px; margin-top:16px;
    }

    @media (max-width:920px){
      .grid{ grid-template-columns:1fr; }
    }

    .panel{ padding:18px 20px; }

    .t{
      font-size:12.5px; letter-spacing:0.14em; text-transform:uppercase;
      margin:0 0 12px 0;
    }

    .levels{ display:flex; gap:10px; flex-wrap:wrap; }

    .lvl{
      border:1px solid var(--border); background:#fff;
      border-radius:999px; padding:10px 14px; font-weight:800;
      cursor:pointer; min-width:185px; text-align:center;
    }

    .lvl[aria-pressed="true"]{ outline:3px solid rgba(0,0,0,0.07); }
    .lvl:disabled{ opacity:0.55; cursor:not-allowed; }

    .pill{
      display:inline-block; border-radius:999px; padding:6px 10px;
      font-size:13.5px; border:1px solid var(--border);
      background:#fff; color:var(--muted); margin:8px 8px 0 0;
    }

    .switch{ display:flex; align-items:center; gap:10px; margin-top:10px; }
    .switch input{ transform:scale(1.1); }

    .tiny{ font-size:14.5px; color:var(--muted); margin-top:8px; }

    .exercise{
      margin-top:16px; border-radius:var(--r); border:1px solid var(--border);
      overflow:hidden; background:#fff; box-shadow:var(--shadow);
    }

    .hdr{ padding:14px 16px; }
    .hdrA{ background:var(--a); color:var(--aInk); }
    .hdrB{ background:var(--b); color:var(--bInk); }
    .hdrC{ background:var(--c); color:var(--cInk); }

    .hdrTitle{
      font-size:12.5px; letter-spacing:0.14em; text-transform:uppercase;
      font-weight:900; margin:0 0 6px 0;
    }

    .hdrSub{ font-weight:760; }

    .body{ padding:16px 16px 18px; }

    .prompt{ font-size:18px; font-weight:850; margin:0 0 10px 0; }

    .story{
      background:#fbfbfa; border:1px solid var(--border);
      border-radius:14px; padding:12px 12px; margin:10px 0 12px 0;
      color:#2b2927;
    }

    .sentence{
      background:#fff; border:1px solid var(--border);
      border-radius:14px; padding:12px 12px; margin:0 0 12px 0;
      font-size:17px;
    }

    .choices{ display:grid; gap:10px; margin-top:10px; }

    .choice{
      border:1px solid var(--border); border-radius:14px; padding:12px 12px;
      cursor:pointer; background:#fff; display:flex; gap:10px; align-items:flex-start;
    }

    .choice input{ margin-top:3px; transform:scale(1.2); }

    .controls{ margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; }

    .btn{
      border:1px solid var(--border); background:#fff; border-radius:12px;
      padding:10px 14px; font-weight:850; cursor:pointer; min-width:160px;
    }

    .primary{ background:#111; color:#fff; border-color:#111; }
    .btn:disabled{ opacity:0.6; cursor:not-allowed; }

    .fb{
      margin-top:14px; border-radius:14px; padding:12px 12px;
      border:1px solid var(--border); background:#fbfbfa; display:none;
    }

    .fbTitle{ margin:0 0 8px 0; font-weight:950; letter-spacing:0.2px; }
    .good{ color:var(--good); } .bad{ color:var(--bad); }

    .fbBlock{
      background:#fff; border:1px solid var(--border); border-radius:12px;
      padding:10px 12px; margin-top:10px;
    }

    .fbLabel{
      font-size:12.5px; letter-spacing:0.12em; text-transform:uppercase;
      color:var(--muted); margin:0 0 6px 0;
    }

    .fbText{ margin:0; }

    .teacher{ margin-top:10px; color:var(--muted); font-size:14px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <p class="k">BUSN 2100 · Transitional Expressions Practice</p>
      <h1>Transitional Expressions Trainer. Context first. Retry until correct ✨</h1>
      <div class="sub">
        Each question gives a short, real-life backstory. Then you choose the transition that fits the relationship.
        If you choose wrong, you will get a hint and you try again. The tool does not reveal the correct answer until you choose it.
        Unlock the next level after <strong>6 correct</strong> at the current level.
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <p class="t">Choose a level</p>
        <div class="levels">
          <button id="l1" class="lvl" aria-pressed="true">Level 1. Core relationships</button>
          <button id="l2" class="lvl" aria-pressed="false" disabled>Level 2. Nuance</button>
          <button id="l3" class="lvl" aria-pressed="false" disabled>Level 3. Punctuation and placement</button>
        </div>

        <div>
          <span id="pillLevel" class="pill">Current level: Level 1</span>
          <span id="pillScore" class="pill">Correct at this level: 0</span>
          <span class="pill">Unlock rule: 6 correct</span>
        </div>

        <div class="switch">
          <input id="teacherMode" type="checkbox" />
          <label for="teacherMode"><strong>Teacher Mode</strong> shows the relationship type</label>
        </div>

        <div class="tiny" id="unlockNote">Level 2 unlocks after 6 correct in Level 1.</div>
      </div>

      <div class="panel">
        <p class="t">What you are practicing</p>
        <div class="tiny"><strong>Contrast</strong>. <strong>Cause and effect</strong>. <strong>Reason</strong>. <strong>Evidence</strong>. <strong>Response</strong>. <strong>Sequence</strong>.</div>
        <div class="tiny">You are also practicing punctuation, like commas after <strong>however</strong> and semicolon patterns such as <strong>; however,</strong>.</div>
      </div>
    </div>

    <div class="exercise">
      <div id="hdr" class="hdr hdrA">
        <div id="hdrTitle" class="hdrTitle">Level 1</div>
        <div id="hdrSub" class="hdrSub">Pick the transition that matches the relationship</div>
      </div>

      <div class="body">
        <p id="prompt" class="prompt">Loading…</p>

        <div id="story" class="story" style="display:none;"></div>
        <div id="sentence" class="sentence" style="display:none;"></div>

        <fieldset class="choices" id="choices">
          <legend style="position:absolute;left:-9999px;">Answer choices</legend>
        </fieldset>

        <div class="controls">
          <button id="check" class="btn primary" disabled>Check</button>
          <button id="next" class="btn" disabled>Next question</button>
          <button id="newBtn" class="btn">New question</button>
        </div>

        <div id="fb" class="fb">
          <div id="fbTitle" class="fbTitle"></div>

          <div class="fbBlock" id="fbHintWrap" style="display:none;">
            <div class="fbLabel">Hint</div>
            <p id="fbHint" class="fbText"></p>
          </div>

          <div class="fbBlock" id="fbWrongWrap" style="display:none;">
            <div class="fbLabel">Why your choice does not fit</div>
            <p id="fbWrong" class="fbText"></p>
          </div>

          <div class="fbBlock" id="fbCorrectWrap" style="display:none;">
            <div class="fbLabel">Correct answer</div>
            <p id="fbCorrect" class="fbText"></p>
          </div>

          <div class="fbBlock" id="fbWhyWrap" style="display:none;">
            <div class="fbLabel">Why this is correct</div>
            <p id="fbWhy" class="fbText"></p>
          </div>

          <div id="teacherInfo" class="teacher" style="display:none;"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  const LEVELS = {
    1: { name:"Level 1", hdr:"hdrA", title:"Level 1", sub:"Core relationships with clear context" },
    2: { name:"Level 2", hdr:"hdrB", title:"Level 2", sub:"Nuance when more than one option feels possible" },
    3: { name:"Level 3", hdr:"hdrC", title:"Level 3", sub:"Punctuation and placement rules in realistic sentences" }
  };

  /*
    Structure:
    - story: short backstory with strategic bolding
    - sentence: the sentence with a blank. choices include punctuation.
    - choices: use <strong> tags freely. do not escape.
  */
  const QUESTIONS = [

    /* ======================
       LEVEL 1. CORE RELATIONSHIPS
       Retail and blue collar contexts
    ====================== */

    {
      id:"L1-01", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You asked for Saturday off and you thought it was approved. <strong>Unexpectedly</strong>, you got scheduled anyway.",
      sentence:"You asked for Saturday off; ____ you were still scheduled.",
      choices:[
        "<strong>however</strong>,",
        "<strong>as a result</strong>,",
        "<strong>for example</strong>,",
        "<strong>because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>However</strong> signals <strong>contrast</strong>. You expected one outcome, but got the opposite. The comma is required after <strong>however</strong> here.",
      wrongWhy:[
        "",
        "<strong>As a result</strong> signals cause and effect, not contrast.",
        "<strong>For example</strong> introduces an example, not a surprise shift.",
        "<strong>Because</strong> introduces a reason clause, not a contrast connector after a semicolon."
      ],
      hint:[
        "",
        "Ask: is this a result, or a surprise opposite outcome?",
        "Ask: are you giving an example, or changing direction?",
        "Ask: is the blank asking for a reason, or a contrast move?"
      ],
      conceptTag:"Contrast"
    },

    {
      id:"L1-02", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"The delivery truck arrived late. <strong>As a result</strong>, shelves stayed empty longer and customers complained.",
      sentence:"The delivery truck arrived late; ____ shelves stayed empty longer.",
      choices:[
        "<strong>consequently</strong>,",
        "<strong>however</strong>,",
        "<strong>for instance</strong>,",
        "<strong>on the other hand</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Consequently</strong> signals <strong>cause and effect</strong>. The late truck led to empty shelves. The comma is required after the transition.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast, not effect.",
        "<strong>For instance</strong> introduces an example, not an outcome.",
        "<strong>On the other hand</strong> signals contrast, not effect."
      ],
      hint:[
        "",
        "Ask: effect, or contrast?",
        "Ask: outcome, or example?",
        "Ask: effect, or contrast?"
      ],
      conceptTag:"Cause and effect"
    },

    {
      id:"L1-03", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"Two coworkers called out. You are explaining the <strong>reason</strong> the store was short staffed.",
      sentence:"The store was short staffed ____ two coworkers called out.",
      choices:[
        "<strong>because</strong>",
        "<strong>however</strong>,",
        "<strong>for example</strong>,",
        "<strong>as a result</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Because</strong> introduces a <strong>reason</strong>. No comma is needed here because the reason comes after the main clause.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast, not reason.",
        "<strong>For example</strong> introduces an example, not a reason.",
        "<strong>As a result</strong> signals effect, not reason."
      ],
      hint:[
        "",
        "Ask: reason, or contrast?",
        "Ask: reason, or example?",
        "Ask: reason, or effect?"
      ],
      conceptTag:"Reason"
    },

    {
      id:"L1-04", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"A customer was waiting a long time. You want to add <strong>evidence</strong> for why they are upset.",
      sentence:"The customer is frustrated, ____ they have been waiting 25 minutes.",
      choices:[
        "<strong>given that</strong>",
        "<strong>however</strong>,",
        "<strong>as a result</strong>,",
        "<strong>for instance</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Given that</strong> introduces a <strong>reason</strong> that supports the claim. It is a clean, professional connector.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast, not support.",
        "<strong>As a result</strong> signals effect, not supporting reason.",
        "<strong>For instance</strong> introduces an example, not a reason clause."
      ],
      hint:[
        "",
        "Ask: support and reason, or contrast?",
        "Ask: reason, or effect?",
        "Ask: reason, or example?"
      ],
      conceptTag:"Reason"
    },

    {
      id:"L1-05", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"Your manager says the team is improving. You want to show <strong>proof</strong>.",
      sentence:"The team is improving, ____ a steady drop in customer complaints.",
      choices:[
        "<strong>evidenced by</strong>",
        "<strong>as a result</strong>,",
        "<strong>however</strong>,",
        "<strong>because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>Evidenced by</strong> introduces <strong>evidence</strong>. It supports the claim with proof.",
      wrongWhy:[
        "",
        "<strong>As a result</strong> signals outcome, not evidence supporting the claim.",
        "<strong>However</strong> signals contrast.",
        "<strong>Because</strong> introduces a reason clause, but <strong>evidenced by</strong> is the proof pattern here."
      ],
      hint:[
        "",
        "Ask: proof, or outcome?",
        "Ask: proof, or contrast?",
        "Ask: proof language, or a reason clause?"
      ],
      conceptTag:"Evidence"
    },

    {
      id:"L1-06", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"Customers complained that the signs were confusing. The supervisor changed the signs as a <strong>response</strong>.",
      sentence:"Customers complained about confusing signs; ____ the supervisor rewrote the signage.",
      choices:[
        "<strong>in response</strong>,",
        "<strong>for example</strong>,",
        "<strong>however</strong>,",
        "<strong>since</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>In response</strong> signals a <strong>reaction</strong> to a problem. The comma is required after the transition.",
      wrongWhy:[
        "",
        "<strong>For example</strong> introduces an example, not a reaction.",
        "<strong>However</strong> signals contrast, not reaction.",
        "<strong>Since</strong> introduces a reason clause, not a response connector after a semicolon."
      ],
      hint:[
        "",
        "Ask: reaction, or example?",
        "Ask: reaction, or contrast?",
        "Ask: reaction, or reason?"
      ],
      conceptTag:"Response"
    },

    {
      id:"L1-07", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You are training a new coworker. The steps must be in <strong>order</strong>.",
      sentence:"First, stock the shelves. ____ check expiration dates.",
      choices:[
        "<strong>Next</strong>,",
        "<strong>However</strong>,",
        "<strong>Consequently</strong>,",
        "<strong>For example</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Next</strong> signals <strong>sequence</strong>. The comma is standard after sequence transitions at the start of a sentence.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast, not order.",
        "<strong>Consequently</strong> signals effect, not order.",
        "<strong>For example</strong> introduces an example, not order."
      ],
      hint:[
        "",
        "Ask: order, or contrast?",
        "Ask: order, or effect?",
        "Ask: order, or example?"
      ],
      conceptTag:"Sequence"
    },

    {
      id:"L1-08", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You put your phone away during your shift. You stayed focused. The outcome was better. This is <strong>cause and effect</strong>.",
      sentence:"You reduced distractions during your shift; ____ you finished tasks faster.",
      choices:[
        "<strong>as a result</strong>,",
        "<strong>however</strong>,",
        "<strong>for instance</strong>,",
        "<strong>on the other hand</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>As a result</strong> signals <strong>effect</strong>. The comma is required after the transition.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast.",
        "<strong>For instance</strong> introduces an example.",
        "<strong>On the other hand</strong> signals contrast."
      ],
      hint:[
        "",
        "Ask: effect, or contrast?",
        "Ask: effect, or example?",
        "Ask: effect, or contrast?"
      ],
      conceptTag:"Cause and effect"
    },

    {
      id:"L1-09", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"A cashier handled returns at the front. At the same time, the stockroom team unloaded a truck. This is <strong>timing</strong>.",
      sentence:"The cashier handled returns. ____ the stockroom team unloaded the truck.",
      choices:[
        "<strong>Meanwhile</strong>,",
        "<strong>Consequently</strong>,",
        "<strong>However</strong>,",
        "<strong>Because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>Meanwhile</strong> signals two things happening at the same time. The comma is standard after <strong>Meanwhile</strong>.",
      wrongWhy:[
        "",
        "<strong>Consequently</strong> signals effect, not timing.",
        "<strong>However</strong> signals contrast, not timing.",
        "<strong>Because</strong> introduces a reason clause, not a timing connector."
      ],
      hint:[
        "",
        "Ask: timing, or result?",
        "Ask: timing, or contrast?",
        "Ask: timing, or reason?"
      ],
      conceptTag:"Sequence and timing"
    },

    {
      id:"L1-10", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"The line was long. Even so, customers stayed patient. This is a <strong>contrast</strong> idea.",
      sentence:"The line was long; ____ customers stayed patient.",
      choices:[
        "<strong>nevertheless</strong>,",
        "<strong>for example</strong>,",
        "<strong>as a result</strong>,",
        "<strong>because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>Nevertheless</strong> signals <strong>contrast</strong>. Long line, but patience remained. The comma is required after the transition.",
      wrongWhy:[
        "",
        "<strong>For example</strong> introduces an example.",
        "<strong>As a result</strong> signals effect, not contrast.",
        "<strong>Because</strong> introduces a reason, not contrast after a semicolon."
      ],
      hint:[
        "",
        "Ask: contrast, or example?",
        "Ask: contrast, or effect?",
        "Ask: contrast, or reason?"
      ],
      conceptTag:"Contrast"
    },

    {
      id:"L1-11", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You are giving proof that the schedule change caused problems. You want <strong>evidence</strong>, not an outcome word.",
      sentence:"The schedule change caused problems. ____ three employees had to find last-minute rides.",
      choices:[
        "<strong>For example</strong>,",
        "<strong>Consequently</strong>,",
        "<strong>However</strong>,",
        "<strong>Therefore</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>For example</strong> introduces an <strong>illustration</strong> that supports the claim. The comma is required after it.",
      wrongWhy:[
        "",
        "<strong>Consequently</strong> signals effect, not an example.",
        "<strong>However</strong> signals contrast, not example.",
        "<strong>Therefore</strong> signals a conclusion, not an example."
      ],
      hint:[
        "",
        "Ask: example, or effect?",
        "Ask: example, or contrast?",
        "Ask: example, or conclusion?"
      ],
      conceptTag:"Evidence and illustration"
    },

    {
      id:"L1-12", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"A safety checklist was added after repeated mistakes. This is an <strong>adjustment</strong> and response.",
      sentence:"There were repeated mistakes; ____ the supervisor added a safety checklist.",
      choices:[
        "<strong>accordingly</strong>,",
        "<strong>however</strong>,",
        "<strong>for example</strong>,",
        "<strong>since</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>Accordingly</strong> signals an appropriate adjustment based on what happened. The comma is required after it.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast.",
        "<strong>For example</strong> introduces an example.",
        "<strong>Since</strong> introduces a reason clause, not an adjustment connector after a semicolon."
      ],
      hint:[
        "",
        "Ask: adjustment, or contrast?",
        "Ask: adjustment, or example?",
        "Ask: adjustment, or reason?"
      ],
      conceptTag:"Response and adjustment"
    },

    {
      id:"L1-13", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You are explaining why the wait is longer today. This is a <strong>reason</strong> connector with correct punctuation.",
      sentence:"The wait is longer today ____ we are training new employees.",
      choices:[
        "<strong>because</strong>",
        "<strong>however</strong>,",
        "<strong>consequently</strong>,",
        "<strong>for example</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Because</strong> introduces a reason. No comma is needed before it in this sentence structure.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast.",
        "<strong>Consequently</strong> signals effect.",
        "<strong>For example</strong> introduces an example."
      ],
      hint:[
        "",
        "Ask: reason, or contrast?",
        "Ask: reason, or effect?",
        "Ask: reason, or example?"
      ],
      conceptTag:"Reason"
    },

    {
      id:"L1-14", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You are writing a quick shift update with order. You need <strong>sequence</strong> language and punctuation.",
      sentence:"We will clean the front area first. ____ we will restock the cooler.",
      choices:[
        "<strong>Then</strong>,",
        "<strong>However</strong>,",
        "<strong>As a result</strong>,",
        "<strong>For instance</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Then</strong> signals sequence. The comma is standard after it at the start of a sentence.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast.",
        "<strong>As a result</strong> signals effect, not order.",
        "<strong>For instance</strong> introduces an example."
      ],
      hint:[
        "",
        "Ask: order, or contrast?",
        "Ask: order, or effect?",
        "Ask: order, or example?"
      ],
      conceptTag:"Sequence"
    },

    {
      id:"L1-15", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You want to show that one action led to another. This is <strong>cause and effect</strong>.",
      sentence:"The freezer door was left open; ____ some items thawed.",
      choices:[
        "<strong>therefore</strong>,",
        "<strong>for example</strong>,",
        "<strong>however</strong>,",
        "<strong>meanwhile</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Therefore</strong> signals a conclusion based on what happened. The comma is required after the transition.",
      wrongWhy:[
        "",
        "<strong>For example</strong> introduces an example.",
        "<strong>However</strong> signals contrast.",
        "<strong>Meanwhile</strong> signals timing."
      ],
      hint:[
        "",
        "Ask: effect, or example?",
        "Ask: effect, or contrast?",
        "Ask: effect, or timing?"
      ],
      conceptTag:"Cause and effect"
    },

    {
      id:"L1-16", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You are adding a second piece of support. This is <strong>addition</strong>, not cause and effect.",
      sentence:"The customer gave two complaints; ____ they mentioned the long wait and the wrong item.",
      choices:[
        "<strong>specifically</strong>,",
        "<strong>consequently</strong>,",
        "<strong>however</strong>,",
        "<strong>because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>Specifically</strong> narrows down details. The comma is standard after it.",
      wrongWhy:[
        "",
        "<strong>Consequently</strong> signals effect, not narrowing details.",
        "<strong>However</strong> signals contrast.",
        "<strong>Because</strong> introduces reason, not detail listing."
      ],
      hint:[
        "",
        "Ask: details, or effect?",
        "Ask: details, or contrast?",
        "Ask: details, or reason?"
      ],
      conceptTag:"Evidence and specificity"
    },

    {
      id:"L1-17", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"A coworker apologized, but still demanded a refund. This is a <strong>contrast</strong> move with punctuation.",
      sentence:"The coworker apologized. ____ they still demanded a refund.",
      choices:[
        "<strong>However</strong>,",
        "<strong>However</strong>",
        "<strong>Consequently</strong>,",
        "<strong>For example</strong>,"
      ],
      correctIndex:0,
      correctWhy:"At the start of a sentence, <strong>However</strong> should be followed by a comma. It signals contrast.",
      wrongWhy:[
        "",
        "This is missing the comma. That is incorrect punctuation for this placement.",
        "<strong>Consequently</strong> signals effect, not contrast.",
        "<strong>For example</strong> introduces an example."
      ],
      hint:[
        "",
        "Look at punctuation. At sentence start, transitional words like <strong>However</strong> usually take a comma.",
        "Ask: contrast, or effect?",
        "Ask: contrast, or example?"
      ],
      conceptTag:"Contrast punctuation"
    },

    {
      id:"L1-18", level:1,
      prompt:"Choose the best transition for the blank.",
      story:"You are making a contrast between effort and outcome. This is the classic <strong>despite</strong> pattern.",
      sentence:"____ working the extra shift, you still did not finish all tasks.",
      choices:[
        "<strong>Despite</strong>",
        "<strong>Because</strong>",
        "<strong>For example</strong>,",
        "<strong>Next</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Despite</strong> introduces contrast. Here it is followed by a phrase, and the sentence continues naturally.",
      wrongWhy:[
        "",
        "<strong>Because</strong> would make working the shift the reason for not finishing, which is not the intended relationship.",
        "<strong>For example</strong> introduces illustration, not contrast.",
        "<strong>Next</strong> signals sequence, not contrast."
      ],
      hint:[
        "",
        "Ask: contrast, or reason?",
        "Ask: contrast, or example?",
        "Ask: contrast, or order?"
      ],
      conceptTag:"Contrast despite"
    },

    /* ======================
       LEVEL 2. NUANCE
       More than one option feels possible, choose the best fit
    ====================== */

    {
      id:"L2-01", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"You worked hard on a task, so success would feel expected. The outcome is the opposite. This is <strong>expectation vs reality</strong>.",
      sentence:"You double-checked every item; ____ the order still had mistakes.",
      choices:[
        "<strong>even so</strong>,",
        "<strong>as a result</strong>,",
        "<strong>for instance</strong>,",
        "<strong>because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>Even so</strong> is a clean, strong contrast that fits casual professional tone. The comma is required after it.",
      wrongWhy:[
        "",
        "<strong>As a result</strong> suggests the checking caused mistakes, which flips logic.",
        "<strong>For instance</strong> introduces an example, not contrast.",
        "<strong>Because</strong> introduces reason, not contrast after a semicolon."
      ],
      hint:[
        "",
        "Ask: contrast, or effect?",
        "Ask: contrast, or example?",
        "Ask: contrast, or reason?"
      ],
      conceptTag:"Contrast nuance"
    },

    {
      id:"L2-02", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"Two options might feel close. Choose the one that fits <strong>proof</strong> best.",
      sentence:"The shift was unusually busy, ____ the line reached the back of the store.",
      choices:[
        "<strong>as evidenced by</strong>",
        "<strong>as a result</strong>,",
        "<strong>however</strong>,",
        "<strong>next</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>As evidenced by</strong> is proof language. It supports the claim with evidence, not an outcome word.",
      wrongWhy:[
        "",
        "<strong>As a result</strong> signals effect. Here the second clause is evidence of the first claim.",
        "<strong>However</strong> signals contrast.",
        "<strong>Next</strong> signals order."
      ],
      hint:[
        "",
        "Ask: is the second clause proof, or the effect of a cause?",
        "Ask: proof, or contrast?",
        "Ask: proof, or order?"
      ],
      conceptTag:"Evidence nuance"
    },

    {
      id:"L2-03", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"A customer complained. The manager changed a process. This is response and <strong>alignment</strong>.",
      sentence:"Customers complained about unclear returns; ____ the manager updated the return instructions.",
      choices:[
        "<strong>accordingly</strong>,",
        "<strong>however</strong>,",
        "<strong>for example</strong>,",
        "<strong>because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>Accordingly</strong> shows an adjustment that fits the situation. It is a strong workplace word.",
      wrongWhy:[
        "",
        "<strong>However</strong> signals contrast, not adjustment.",
        "<strong>For example</strong> introduces illustration, not the team’s reaction.",
        "<strong>Because</strong> introduces reason, not an action response connector after a semicolon."
      ],
      hint:[
        "",
        "Ask: adjustment, or contrast?",
        "Ask: adjustment, or example?",
        "Ask: adjustment, or reason?"
      ],
      conceptTag:"Response and adjustment nuance"
    },

    {
      id:"L2-04", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"You are describing sequence, but the second action is also a response. Choose the best fit for <strong>order</strong>.",
      sentence:"First, clock in. ____ check the daily assignment board.",
      choices:[
        "<strong>Next</strong>,",
        "<strong>In response</strong>,",
        "<strong>However</strong>,",
        "<strong>Therefore</strong>,"
      ],
      correctIndex:0,
      correctWhy:"This is a step order. <strong>Next</strong> is the best sequence word here.",
      wrongWhy:[
        "",
        "<strong>In response</strong> implies a reaction to a problem, not a step order.",
        "<strong>However</strong> implies contrast.",
        "<strong>Therefore</strong> implies conclusion."
      ],
      hint:[
        "",
        "Ask: steps in order, or reacting to a problem?",
        "Ask: order, or contrast?",
        "Ask: order, or conclusion?"
      ],
      conceptTag:"Sequence nuance"
    },

    {
      id:"L2-05", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"Two options feel similar. Choose the one that best signals a direct result.",
      sentence:"The store reduced extra meetings; ____ employees had more time on the floor.",
      choices:[
        "<strong>consequently</strong>,",
        "<strong>for example</strong>,",
        "<strong>however</strong>,",
        "<strong>specifically</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Consequently</strong> signals a direct effect of the change. The comma is required after it.",
      wrongWhy:[
        "",
        "<strong>For example</strong> introduces an example, not an effect.",
        "<strong>However</strong> introduces contrast.",
        "<strong>Specifically</strong> narrows details, not cause and effect."
      ],
      hint:[
        "",
        "Ask: effect, or example?",
        "Ask: effect, or contrast?",
        "Ask: effect, or details?"
      ],
      conceptTag:"Cause and effect nuance"
    },

    {
      id:"L2-06", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"You want a professional reason connector that explains why something is surprising.",
      sentence:"It is surprising that the shelf is still empty, ____ the truck arrived two hours ago.",
      choices:[
        "<strong>given that</strong>",
        "<strong>as a result</strong>,",
        "<strong>however</strong>,",
        "<strong>for example</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Given that</strong> introduces a reason that supports the surprise statement.",
      wrongWhy:[
        "",
        "<strong>As a result</strong> signals effect, not supporting reason.",
        "<strong>However</strong> signals contrast, not support.",
        "<strong>For example</strong> introduces an example, not a reason clause."
      ],
      hint:[
        "",
        "Ask: reason support, or effect?",
        "Ask: reason support, or contrast?",
        "Ask: reason support, or example?"
      ],
      conceptTag:"Reason nuance"
    },

    {
      id:"L2-07", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"This is contrast, but you want the cleanest punctuation pattern for two complete sentences.",
      sentence:"The customer was polite; ____ they refused to follow the policy.",
      choices:[
        "<strong>however</strong>,",
        "<strong>however</strong>",
        "<strong>for example</strong>,",
        "<strong>as a result</strong>,"
      ],
      correctIndex:0,
      correctWhy:"After a semicolon, <strong>however</strong> should be followed by a comma. This is correct punctuation and correct logic.",
      wrongWhy:[
        "",
        "This is missing the comma. That is incorrect punctuation in this placement.",
        "<strong>For example</strong> introduces an example, not contrast.",
        "<strong>As a result</strong> signals effect, not contrast."
      ],
      hint:[
        "",
        "This is punctuation. After a semicolon, transitional words like <strong>however</strong> typically take a comma.",
        "Ask: contrast, or example?",
        "Ask: contrast, or effect?"
      ],
      conceptTag:"Contrast punctuation nuance"
    },

    {
      id:"L2-08", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"You are adding more support. It is not an outcome. It is just extra evidence.",
      sentence:"The team is reliable. ____ they covered two extra shifts this week.",
      choices:[
        "<strong>In addition</strong>,",
        "<strong>Consequently</strong>,",
        "<strong>However</strong>,",
        "<strong>Because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>In addition</strong> stacks support. It adds information without implying causation.",
      wrongWhy:[
        "",
        "<strong>Consequently</strong> implies the reliability caused the extra shifts, which is not the intended relationship.",
        "<strong>However</strong> implies contrast.",
        "<strong>Because</strong> introduces reason, not additive support."
      ],
      hint:[
        "",
        "Ask: adding support, or cause and effect?",
        "Ask: adding support, or contrast?",
        "Ask: adding support, or reason?"
      ],
      conceptTag:"Addition"
    },

    {
      id:"L2-09", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"You are describing evidence with a specific instance. Choose the best example word.",
      sentence:"The shift was stressful; ____ three customers argued about the same issue.",
      choices:[
        "<strong>for instance</strong>,",
        "<strong>therefore</strong>,",
        "<strong>however</strong>,",
        "<strong>because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>For instance</strong> introduces a specific illustration. The comma is required after it.",
      wrongWhy:[
        "",
        "<strong>Therefore</strong> signals conclusion, not an example.",
        "<strong>However</strong> signals contrast.",
        "<strong>Because</strong> introduces reason, not an example connector after a semicolon."
      ],
      hint:[
        "",
        "Ask: example, or conclusion?",
        "Ask: example, or contrast?",
        "Ask: example, or reason?"
      ],
      conceptTag:"Evidence example nuance"
    },

    {
      id:"L2-10", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"This is a reason connector at the start of a sentence. Punctuation matters.",
      sentence:"____ the register system restarted, the line slowed down.",
      choices:[
        "<strong>Because</strong>",
        "<strong>Because</strong>,",
        "<strong>However</strong>,",
        "<strong>Consequently</strong>,"
      ],
      correctIndex:0,
      correctWhy:"At sentence start, you write <strong>Because</strong> plus the clause, then a comma later. You do not write <strong>Because</strong> with a comma immediately after it.",
      wrongWhy:[
        "",
        "This comma is in the wrong place. The comma belongs after the full dependent clause, not after the word <strong>Because</strong> alone.",
        "<strong>However</strong> signals contrast, not reason.",
        "<strong>Consequently</strong> signals effect, not reason."
      ],
      hint:[
        "",
        "This is punctuation. The comma comes after the whole dependent clause, not after the word <strong>Because</strong> by itself.",
        "Ask: reason, or contrast?",
        "Ask: reason, or effect?"
      ],
      conceptTag:"Reason punctuation nuance"
    },

    {
      id:"L2-11", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"This is a clear cause and effect chain. Choose the best effect connector.",
      sentence:"The cooler broke overnight; ____ some items had to be thrown away.",
      choices:[
        "<strong>as a result</strong>,",
        "<strong>for example</strong>,",
        "<strong>however</strong>,",
        "<strong>in addition</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>As a result</strong> signals effect. It is the best fit for the logic.",
      wrongWhy:[
        "",
        "<strong>For example</strong> introduces an example, not an outcome.",
        "<strong>However</strong> introduces contrast.",
        "<strong>In addition</strong> adds information, not an outcome."
      ],
      hint:[
        "",
        "Ask: effect, or example?",
        "Ask: effect, or contrast?",
        "Ask: effect, or addition?"
      ],
      conceptTag:"Cause and effect"
    },

    {
      id:"L2-12", level:2,
      prompt:"Choose the strongest transition for the blank.",
      story:"This is a response to feedback. Choose the best response connector.",
      sentence:"Employees asked for clearer instructions; ____ the lead created a short checklist.",
      choices:[
        "<strong>in response</strong>,",
        "<strong>for example</strong>,",
        "<strong>however</strong>,",
        "<strong>because</strong>"
      ],
      correctIndex:0,
      correctWhy:"<strong>In response</strong> signals reaction to a request. The comma is required after it.",
      wrongWhy:[
        "",
        "<strong>For example</strong> introduces an example, not a response action.",
        "<strong>However</strong> signals contrast.",
        "<strong>Because</strong> introduces reason, not a response connector."
      ],
      hint:[
        "",
        "Ask: response, or example?",
        "Ask: response, or contrast?",
        "Ask: response, or reason?"
      ],
      conceptTag:"Response"
    },

    /* ======================
       LEVEL 3. PUNCTUATION AND PLACEMENT
       More technical, still contextual and concrete
    ====================== */

    {
      id:"L3-01", level:3,
      prompt:"Choose the best option that fixes punctuation and meaning.",
      story:"You are writing two complete sentences with a contrast. You want the clean semicolon pattern.",
      sentence:"The customer said they understood the policy ____ they still demanded an exception.",
      choices:[
        "<strong>; however,</strong>",
        "<strong>, however,</strong>",
        "<strong>; because</strong>",
        "<strong>; for example,</strong>"
      ],
      correctIndex:0,
      correctWhy:"Two complete sentences can be joined as <strong>sentence; however, sentence</strong>. This is correct meaning and correct punctuation.",
      wrongWhy:[
        "",
        "This comma pattern would create a comma splice if both sides are complete sentences.",
        "<strong>Because</strong> introduces reason, not contrast, and punctuation is incorrect for this structure.",
        "<strong>For example</strong> introduces an example, not contrast."
      ],
      hint:[
        "",
        "If both sides are complete sentences, a comma alone is not strong enough. Think semicolon pattern.",
        "Ask: contrast, or reason?",
        "Ask: contrast, or example?"
      ],
      conceptTag:"Contrast semicolon pattern"
    },

    {
      id:"L3-02", level:3,
      prompt:"Choose the best option that fixes punctuation and meaning.",
      story:"This one is about <strong>because</strong> placement and commas. You want the correct reason structure.",
      sentence:"Because the truck arrived late ____ the shelves stayed empty longer.",
      choices:[
        "<strong>,</strong>",
        "<strong>;</strong>",
        "<strong>however,</strong>",
        "<strong>therefore,</strong>"
      ],
      correctIndex:0,
      correctWhy:"When the sentence starts with <strong>Because</strong>, you usually place a comma after the dependent clause: <strong>Because clause, main clause</strong>.",
      wrongWhy:[
        "",
        "A semicolon is not used here because the first part is not a complete sentence by itself.",
        "<strong>However</strong> would change the relationship and does not fix punctuation.",
        "<strong>Therefore</strong> does not belong inside this structure."
      ],
      hint:[
        "",
        "Ask: is the first part a complete sentence? If not, semicolon is not the fix.",
        "Ask: reason connector, or contrast connector?",
        "Ask: is this a because sentence, or a conclusion sentence?"
      ],
      conceptTag:"Because comma rule"
    },

    {
      id:"L3-03", level:3,
      prompt:"Choose the best option that fixes punctuation and meaning.",
      story:"This is about <strong>However</strong> at the start of a sentence. Punctuation matters.",
      sentence:"However ____ the store stayed calm during the rush.",
      choices:[
        "<strong>,</strong>",
        "<strong>;</strong>",
        "<strong>because</strong>",
        "<strong>therefore</strong>"
      ],
      correctIndex:0,
      correctWhy:"At the start of a sentence, <strong>However</strong> is typically followed by a comma: <strong>However,</strong> sentence.",
      wrongWhy:[
        "",
        "A semicolon does not belong right after <strong>However</strong> at sentence start.",
        "<strong>Because</strong> changes the meaning and structure.",
        "<strong>Therefore</strong> changes the meaning and structure."
      ],
      hint:[
        "",
        "At sentence start, <strong>However</strong> usually takes a comma.",
        "Ask: do you want contrast, or a reason clause?",
        "Ask: do you want contrast, or a conclusion?"
      ],
      conceptTag:"However comma rule"
    },

    {
      id:"L3-04", level:3,
      prompt:"Choose the best option that fixes grammar and meaning.",
      story:"This is <strong>despite</strong> versus <strong>although</strong>. One takes a noun phrase. The other takes a full clause.",
      sentence:"____ the line was long, customers stayed patient.",
      choices:[
        "<strong>Although</strong>",
        "<strong>Despite</strong>",
        "<strong>For example</strong>,",
        "<strong>Consequently</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>Although</strong> can introduce a full clause: <strong>Although the line was long,</strong> customers stayed patient. <strong>Despite</strong> would need a noun phrase: <strong>Despite the long line</strong>.",
      wrongWhy:[
        "",
        "<strong>Despite</strong> should not be followed by a full clause in this structure.",
        "<strong>For example</strong> introduces an example, not contrast clause structure.",
        "<strong>Consequently</strong> signals effect, not contrast clause structure."
      ],
      hint:[
        "",
        "If the next words form a full sentence clause, <strong>although</strong> is usually the better fit than <strong>despite</strong>.",
        "Ask: clause structure, or example?",
        "Ask: clause structure, or effect?"
      ],
      conceptTag:"Despite vs although"
    },

    {
      id:"L3-05", level:3,
      prompt:"Choose the best option that creates the intended meaning.",
      story:"This is addition versus cause and effect. The second sentence adds more support, it does not claim causation.",
      sentence:"The report includes two customer quotes. ____ it includes survey data from 200 people.",
      choices:[
        "<strong>In addition</strong>,",
        "<strong>As a result</strong>,",
        "<strong>Consequently</strong>,",
        "<strong>However</strong>,"
      ],
      correctIndex:0,
      correctWhy:"<strong>In addition</strong> stacks support. It adds evidence without claiming the first thing caused the second thing.",
      wrongWhy:[
        "",
        "<strong>As a result</strong> implies a causal chain that is not intended.",
        "<strong>Consequently</strong> also implies causation.",
        "<strong>However</strong> implies contrast."
      ],
      hint:[
        "",
        "Ask: are you adding support, or describing an effect?",
        "Ask: addition, or effect?",
        "Ask: addition, or contrast?"
      ],
      conceptTag:"Addition vs effect"
    },

    {
      id:"L3-06", level:3,
      prompt:"Choose the best option that fixes punctuation and meaning.",
      story:"This is a two-sentence cause and effect structure. You want the clean semicolon pattern with a comma after the transition.",
      sentence:"The schedule was posted late ____ several employees had to find last-minute rides.",
      choices:[
        "<strong>; therefore,</strong>",
        "<strong>, therefore,</strong>",
        "<strong>; however,</strong>",
        "<strong>; for example,</strong>"
      ],
      correctIndex:0,
      correctWhy:"If both sides are complete sentences, the clean pattern is <strong>sentence; therefore, sentence</strong>. This is correct punctuation and correct logic.",
      wrongWhy:[
        "",
        "This comma pattern would create a comma splice if both sides are complete sentences.",
        "<strong>However</strong> signals contrast, not cause and effect.",
        "<strong>For example</strong> introduces an example, not cause and effect."
      ],
      hint:[
        "",
        "If both sides are complete sentences, a comma alone is not enough. Think semicolon.",
        "Ask: effect, or contrast?",
        "Ask: effect, or example?"
      ],
      conceptTag:"Therefore semicolon pattern"
    }

  ];

  const els = {
    l1:document.getElementById("l1"),
    l2:document.getElementById("l2"),
    l3:document.getElementById("l3"),
    pillLevel:document.getElementById("pillLevel"),
    pillScore:document.getElementById("pillScore"),
    unlockNote:document.getElementById("unlockNote"),
    teacherMode:document.getElementById("teacherMode"),
    hdr:document.getElementById("hdr"),
    hdrTitle:document.getElementById("hdrTitle"),
    hdrSub:document.getElementById("hdrSub"),
    prompt:document.getElementById("prompt"),
    story:document.getElementById("story"),
    sentence:document.getElementById("sentence"),
    choices:document.getElementById("choices"),
    check:document.getElementById("check"),
    next:document.getElementById("next"),
    newBtn:document.getElementById("newBtn"),
    fb:document.getElementById("fb"),
    fbTitle:document.getElementById("fbTitle"),
    fbHintWrap:document.getElementById("fbHintWrap"),
    fbHint:document.getElementById("fbHint"),
    fbWrongWrap:document.getElementById("fbWrongWrap"),
    fbWrong:document.getElementById("fbWrong"),
    fbCorrectWrap:document.getElementById("fbCorrectWrap"),
    fbCorrect:document.getElementById("fbCorrect"),
    fbWhyWrap:document.getElementById("fbWhyWrap"),
    fbWhy:document.getElementById("fbWhy"),
    teacherInfo:document.getElementById("teacherInfo")
  };

  let currentLevel = 1;
  let currentQ = null;
  let selected = null;

  let unlocked = {1:true,2:false,3:false};
  let correctAt = {1:0,2:0,3:0};

  let remaining = {1:[],2:[],3:[]};

  function shuffle(arr){
    for(let i=arr.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
  }

  function initRemaining(){
    [1,2,3].forEach(lvl=>{
      remaining[lvl] = QUESTIONS.filter(q=>q.level===lvl).map(q=>q.id);
      shuffle(remaining[lvl]);
    });
  }

  function getNextQuestion(lvl){
    if(remaining[lvl].length===0){
      remaining[lvl] = QUESTIONS.filter(q=>q.level===lvl).map(q=>q.id);
      shuffle(remaining[lvl]);
    }
    const id = remaining[lvl].pop();
    return QUESTIONS.find(q=>q.id===id);
  }

  function refreshUnlockUI(){
    els.l2.disabled = !unlocked[2];
    els.l3.disabled = !unlocked[3];

    let msg = "";
    if(!unlocked[2]) msg = "Level 2 unlocks after 6 correct in Level 1.";
    if(unlocked[2] && !unlocked[3]) msg = "Level 3 unlocks after 6 correct in Level 2.";
    if(unlocked[3]) msg = "All levels unlocked. Keep going for mastery.";
    els.unlockNote.textContent = msg;
  }

  function setLevel(lvl){
    currentLevel = lvl;

    els.l1.setAttribute("aria-pressed", lvl===1 ? "true":"false");
    els.l2.setAttribute("aria-pressed", lvl===2 ? "true":"false");
    els.l3.setAttribute("aria-pressed", lvl===3 ? "true":"false");

    els.pillLevel.textContent = "Current level: " + LEVELS[lvl].name;
    els.pillScore.textContent = "Correct at this level: " + correctAt[lvl];

    els.hdr.className = "hdr " + LEVELS[lvl].hdr;
    els.hdrTitle.textContent = LEVELS[lvl].title;
    els.hdrSub.textContent = LEVELS[lvl].sub;

    loadQuestion();
  }

  function resetFeedback(){
    els.fb.style.display = "none";
    els.fbTitle.textContent = "";
    els.fbHintWrap.style.display = "none";
    els.fbHint.textContent = "";
    els.fbWrongWrap.style.display = "none";
    els.fbWrong.innerHTML = "";
    els.fbCorrectWrap.style.display = "none";
    els.fbCorrect.textContent = "";
    els.fbWhyWrap.style.display = "none";
    els.fbWhy.innerHTML = "";
    els.teacherInfo.style.display = "none";
    els.teacherInfo.textContent = "";
  }

  function loadQuestion(){
    selected = null;
    currentQ = getNextQuestion(currentLevel);
    resetFeedback();

    els.prompt.textContent = currentQ.prompt;

    els.story.style.display = "block";
    els.story.innerHTML = currentQ.story;

    els.sentence.style.display = "block";
    els.sentence.innerHTML = "<strong>Sentence:</strong> " + currentQ.sentence;

    els.choices.innerHTML = '<legend style="position:absolute;left:-9999px;">Answer choices</legend>';

    currentQ.choices.forEach((txt, idx)=>{
      const label = document.createElement("label");
      label.className = "choice";
      label.innerHTML = `
        <input type="radio" name="choice" value="${idx}" />
        <div>${txt}</div>
      `;
      label.addEventListener("click", ()=>{
        selected = idx;
        els.check.disabled = false;
      });
      els.choices.appendChild(label);
    });

    els.check.disabled = true;
    els.next.disabled = true;
  }

  function showWrong(idx){
    els.fb.style.display = "block";
    els.fbTitle.textContent = "Not quite yet. Try again.";
    els.fbTitle.className = "fbTitle bad";

    els.fbHintWrap.style.display = "block";
    els.fbHint.textContent = (currentQ.hint && currentQ.hint[idx]) ? currentQ.hint[idx]
      : "Hint: name the relationship first. Contrast, effect, reason, response, evidence, or sequence.";

    els.fbWrongWrap.style.display = "block";
    const msg = (currentQ.wrongWhy && currentQ.wrongWhy[idx]) ? currentQ.wrongWhy[idx]
      : "That option signals a different relationship than the sentence needs.";
    els.fbWrong.innerHTML = "<strong>Your choice:</strong> " + msg;

    if(els.teacherMode.checked){
      els.teacherInfo.style.display = "block";
      els.teacherInfo.textContent = "Relationship type: " + currentQ.conceptTag;
    }
  }

  function showCorrect(){
    els.fb.style.display = "block";
    els.fbTitle.textContent = "Correct ✅";
    els.fbTitle.className = "fbTitle good";

    els.fbCorrectWrap.style.display = "block";
    els.fbCorrect.textContent = "Option " + (currentQ.correctIndex+1);

    els.fbWhyWrap.style.display = "block";
    els.fbWhy.innerHTML = currentQ.correctWhy;

    if(els.teacherMode.checked){
      els.teacherInfo.style.display = "block";
      els.teacherInfo.textContent = "Relationship type: " + currentQ.conceptTag;
    }
  }

  els.check.addEventListener("click", ()=>{
    if(selected === null) return;

    const isCorrect = selected === currentQ.correctIndex;

    if(isCorrect){
      correctAt[currentLevel] += 1;
      els.pillScore.textContent = "Correct at this level: " + correctAt[currentLevel];

      if(currentLevel === 1 && correctAt[1] >= 6) unlocked[2] = true;
      if(currentLevel === 2 && correctAt[2] >= 6) unlocked[3] = true;
      refreshUnlockUI();

      showCorrect();

      els.next.disabled = false;
      els.check.disabled = true;

      const radios = document.querySelectorAll('input[name="choice"]');
      radios.forEach(r=> r.disabled = true);

    } else {
      showWrong(selected);
      els.next.disabled = true;
      els.check.disabled = false;
    }
  });

  els.next.addEventListener("click", ()=> loadQuestion());
  els.newBtn.addEventListener("click", ()=> loadQuestion());

  els.teacherMode.addEventListener("change", ()=>{
    if(els.fb.style.display !== "none"){
      if(els.teacherMode.checked){
        els.teacherInfo.style.display = "block";
        els.teacherInfo.textContent = "Relationship type: " + currentQ.conceptTag;
      } else {
        els.teacherInfo.style.display = "none";
        els.teacherInfo.textContent = "";
      }
    }
  });

  els.l1.addEventListener("click", ()=> setLevel(1));
  els.l2.addEventListener("click", ()=> { if(unlocked[2]) setLevel(2); });
  els.l3.addEventListener("click", ()=> { if(unlocked[3]) setLevel(3); });

  initRemaining();
  refreshUnlockUI();
  setLevel(1);
</script>
</body>
</html>
